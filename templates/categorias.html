{% extends "base.html" %}

{% block title %}Explorar Categorías - Pixsoft{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/categorias.css') }}">
<style>
    .products-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    .products-table th, .products-table td {
        padding: 12px;
        border: 1px solid #ccc;
        text-align: center;
    }
    .products-table th {
        background-color: #4F46E5;
        color: white;
    }
    .products-table img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
    }
    .add-to-cart-btn {
        padding: 6px 12px;
        background-color: #10B981;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
</style>
{% endblock %}

{% block content %}
<main class="categories-page-content">
    <div class="content-wrapper">
        <aside class="sidebar-categories">
            <h2>Categorías Principales</h2>
            <ul class="category-list">
                {% for cat in categorias %}
                <li class="category-item {% if loop.first %}active{% endif %}">
                    <a href="#" data-category="{{ cat.nombre }}">{{ cat.nombre }}</a>
                </li>
                {% endfor %}
            </ul>
        </aside>

        <section class="main-content-products">
            <h2>Productos por Categoría</h2>

            {% for categoria_nombre, productos in productos_por_categoria.items() %}
            <div class="category-products" data-category="{{ categoria_nombre }}" {% if not loop.first %}style="display:none"{% endif %}>
                {% if productos %}
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for producto in productos %}
                        <tr>
                            <td>
                                <img src="{{ url_for('static', filename='imagenes/' + (producto.img or 'noimage.png')) }}" alt="{{ producto.nombre }}">
                            </td>
                            <td>{{ producto.nombre }}</td>
                            <td>${{ producto.precio }}</td>
                            <td>
                                <button class="add-to-cart-btn">+</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p>No hay productos en esta categoría.</p>
                {% endif %}
            </div>
            {% endfor %}
        </section>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<script>
    const categoryLinks = document.querySelectorAll('.category-item a');
    const categorySections = document.querySelectorAll('.category-products');

    categoryLinks.forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            const selectedCategory = link.dataset.category;

            // Activar el estilo activo
            document.querySelectorAll('.category-item').forEach(li => li.classList.remove('active'));
            link.closest('.category-item').classList.add('active');

            // Mostrar solo la categoría seleccionada
            categorySections.forEach(sec => {
                if(sec.dataset.category === selectedCategory){
                    sec.style.display = 'block';
                } else {
                    sec.style.display = 'none';
                }
            });

            // Cambiar título principal
            document.querySelector('.main-content-products h2').textContent = `Productos - ${selectedCategory}`;
        });
    });
</script>
{% endblock %}
